//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by 'AltaSoft Storm ORM Generator'.
//     Changes to this file may cause incorrect behavior and will be lost if the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

#nullable enable

using System;
using System.Collections.Generic;
using AltaSoft.Storm.Attributes;
using AltaSoft.Storm.Interfaces;
using AltaSoft.Storm.TestModels.VeryBadNamespace;
using System.ComponentModel;
using System.Data;
using System.Data.Common;
using System.Linq;
using System.Linq.Expressions;
using System.Runtime.CompilerServices;
using System.Threading;
using System.Threading.Tasks;
using AltaSoft.Storm;
using AltaSoft.Storm.Crud;
using AltaSoft.Storm.Exceptions;
using AltaSoft.Storm.Extensions;

#pragma warning disable IDE1006, CS0612, CS8618
// ReSharper disable InconsistentNaming

namespace AltaSoft.Storm.TestModels;

// UpdateMode: NoUpdates
// 0. (dbo.MyProc - StoredProcedure, NoUpdates
internal sealed partial record ProcUser : IDataBindableWithKey, IConcurrencyCheck, IEntityComparer<ProcUser>
{
    /// <summary>
    /// Default constructor.
    /// </summary>
    public ProcUser()
    {
    }

    /// <summary>
    /// Initializes a new instance with the values from the specified DbDataReader and updates the index.
    /// </summary>
    /// <param name="dr">The DbDataReader object containing the data.</param>
    /// <param name="partialLoadFlags">The PartialLoadFlags that used when loading this instance from database.</param>
    /// <param name="idx">The reference to the index.</param>
    #if NET7_0_OR_GREATER
    [System.Diagnostics.CodeAnalysis.SetsRequiredMembers]
    #endif
    internal ProcUser(StormDbDataReader dr, uint partialLoadFlags, ref int idx)
    {
        __loadingFlags = partialLoadFlags;
        UserId = (AltaSoft.Storm.TestModels.DomainTypes.UserId)(int)dr.GetInt32(idx++);
        BranchId = (short)dr.GetInt16(idx++);
        AutoInc = (int)dr.GetInt32(idx++);
        RowVersion = (AltaSoft.Storm.SqlRowVersion)dr.GetBinary(idx++);
        Version = (int)dr.GetInt32(idx++);
        LoginName = (string)dr.GetAnsiString(idx++);
        FullName = (string?)dr.GetStringOrNull(idx++);
        Roles = dr.AsJsonOrNull<System.Collections.Generic.List<int>>(idx++);
        DatePair = dr.AsFlatObject<AltaSoft.Storm.TestModels.DatePair>(ref idx);
        CustomerId = (AltaSoft.Storm.TestModels.VeryBadNamespace.CustomerId)(long)dr.GetInt64(idx++);
        CustomerId2 = (AltaSoft.Storm.TestModels.VeryBadNamespace.CustomerId?)(long?)dr.GetInt64OrNull(idx++);
        CurrencyId = (AltaSoft.Storm.TestModels.VeryBadNamespace.CurrencyId)(string)dr.GetAnsiStringFixedLength(idx++);
        TwoValues = dr.AsJsonOrNull<AltaSoft.Storm.TestModels.TwoValues>(idx++);

        __saved_RowVersion = RowVersion;
        __saved_Version = Version;
        __saved_DatePair_Date1 = DatePair.Date1;
    }

    private AltaSoft.Storm.SqlRowVersion __saved_RowVersion;
    private int __saved_Version;
    private System.DateOnly __saved_DatePair_Date1;

    /// <inheritdoc />
    public bool KeyEquals(ProcUser other) => UserId == other.UserId && BranchId == other.BranchId;

    /// <inheritdoc />
    public object __GetKeyValue() => (UserId, BranchId);


    /// <inheritdoc />
    public void __SetAutoIncValue(StormDbDataReader dr, int idx)
    {
        AutoInc = (int)dr.GetInt32(idx++);
    }

    /// <inheritdoc />
    public void __AddDetailRow(StormColumnDef column, object row)
    {
        switch (column.PropertyName)
        {
            case nameof(Dates):
                Dates ??= new(); 
                Dates.Add((AltaSoft.Storm.TestModels.DatePair)row);
                break;
            case nameof(Cars):
                Cars ??= new(); 
                Cars.Add((AltaSoft.Storm.TestModels.Car)row);
                break;
            case nameof(ListOfStrings):
                ListOfStrings ??= new(); 
                ListOfStrings.Add((string)row);
                break;
            case nameof(ListOfIntegers):
                ListOfIntegers ??= new(); 
                ListOfIntegers.Add((int)row);
                break;
        }
    }

    /// <summary>
    /// Represents a set of flags that can be used to specify partial loading options.
    /// </summary>
    [Flags]
    public enum PartialLoadFlags : uint
    {
        Basic = 0,
        FullName = 1,
        Roles = 2,
        TwoValues = 4,
        Dates = 8, // Detail table
        Cars = 16, // Detail table
        ListOfStrings = 32, // Detail table
        ListOfIntegers = 64, // Detail table
        All = Basic | FullName | Roles | TwoValues | Dates | Cars | ListOfStrings | ListOfIntegers,
        AllExceptDetailTables = Basic | FullName | Roles | TwoValues
    }

    /// <summary>
    /// Enum representing different options for ordering data.
    /// </summary>
    public enum OrderBy
    {
        UserId = 1,
        UserId_Desc = -1,
        BranchId = 2,
        BranchId_Desc = -2,
        AutoInc = 3,
        AutoInc_Desc = -3,
        RowVersion = 4,
        RowVersion_Desc = -4,
        Version = 5,
        Version_Desc = -5,
        LoginName = 6,
        LoginName_Desc = -6,
        FullName = 7,
        FullName_Desc = -7,
        DatePair_Date1 = 9,
        DatePair_Date1_Desc = -9,
        DatePair_Date2 = 10,
        DatePair_Date2_Desc = -10,
        CustomerId = 11,
        CustomerId_Desc = -11,
        CustomerId2 = 12,
        CustomerId2_Desc = -12,
        CurrencyId = 13,
        CurrencyId_Desc = -13
    }

    /// <summary>
    /// Do not order queried data.
    /// </summary>
    public const OrderBy[]? Unordered = default;

    /// <summary>
    /// Order queried data by the OrderBy.UserId and OrderBy.BranchId columns
    /// </summary>
    public static readonly OrderBy[] OrderByKey = new[] { OrderBy.UserId, OrderBy.BranchId };

    private readonly uint? __loadingFlags;
    /// <inheritdoc />
    [EditorBrowsable(EditorBrowsableState.Never)]
    public uint? __GetLoadingFlags() => __loadingFlags;

    /// <inheritdoc />
    [EditorBrowsable(EditorBrowsableState.Never)]
    public (StormColumnDef column, object? value)[] __GetColumnValues()
    {
        var columnDefs = ProcUserStormController.__columnDefs;

        return [
            (columnDefs[0], (int)UserId),
            (columnDefs[1], BranchId),
            (columnDefs[2], AutoInc),
            (columnDefs[3], (byte[])RowVersion),
            (columnDefs[4], Version),
            (columnDefs[5], LoginName),
            (columnDefs[6], FullName),
            (columnDefs[7], (object?)Roles),
            (columnDefs[8], (DateOnly)DatePair.Date1),
            (columnDefs[9], (DateOnly?)DatePair.Date2),
            (columnDefs[10], (long)CustomerId),
            (columnDefs[11], (long?)CustomerId2),
            (columnDefs[12], (string)CurrencyId),
            (columnDefs[13], (object?)TwoValues),
            (columnDefs[14], Dates),
            (columnDefs[15], Cars),
            (columnDefs[16], ListOfStrings),
            (columnDefs[17], ListOfIntegers)
        ];
    }


    #region Concurrency Support

    /// <inheritdoc />
    public (StormColumnDef column, object? value)[] __ConcurrencyColumnValues()
    {
        var columnDefs = ProcUserStormController.__columnDefs;

        return [
            (columnDefs[3], (byte[])__saved_RowVersion),
            (columnDefs[4], __saved_Version),
            (columnDefs[8], (DateOnly)__saved_DatePair_Date1),
        ];
    }

    #endregion Concurrency Support
}

/// <summary>
/// 0. StormController for the ProcUser (dbo.MyProc)
/// </summary>
[StormController("dbo", "MyProc", typeof(ProcUser), 0, DbObjectType.StoredProcedure)]
internal sealed class ProcUserStormController : StormControllerBase
{
    public ProcUserStormController(string? schemaName, string objectName, DbObjectType objectType) : base(schemaName, objectName, objectType)
    {
    }

    /// <inheritdoc />
    public override Type StormContext => typeof(TestStormContext);

    [System.Runtime.CompilerServices.ModuleInitializer]
    internal static void Initialize()
    {
        StormControllerBase ctrl;
        ctrl = new ProcUserStormController("dbo", "MyProc", DbObjectType.StoredProcedure);
        StormControllerCache.Add(typeof(ProcUser), 0, ctrl);
    }

    /// <inheritdoc />
    public override IDataBindable Create(StormDbDataReader dr, uint partialLoadFlags, ref int idx)
    {
        var result = new ProcUser(dr, partialLoadFlags, ref idx);
        result.AfterLoad(partialLoadFlags);
        return result;
    }

    /// <inheritdoc />
    public override object? ReadSingleScalarValue(StormDbDataReader dr, string propertyName, ref int idx)
    {
        return propertyName switch
        {
            nameof(ProcUser.UserId) => (AltaSoft.Storm.TestModels.DomainTypes.UserId)(int)dr.GetInt32(idx++),
            nameof(ProcUser.BranchId) => (short)dr.GetInt16(idx++),
            nameof(ProcUser.AutoInc) => (int)dr.GetInt32(idx++),
            nameof(ProcUser.RowVersion) => (AltaSoft.Storm.SqlRowVersion)dr.GetBinary(idx++),
            nameof(ProcUser.Version) => (int)dr.GetInt32(idx++),
            nameof(ProcUser.LoginName) => (string)dr.GetAnsiString(idx++),
            nameof(ProcUser.FullName) => (string?)dr.GetStringOrNull(idx++),
            nameof(ProcUser.Roles) => dr.AsJsonOrNull<System.Collections.Generic.List<int>>(idx++),
            nameof(ProcUser.DatePair) => dr.AsFlatObject<AltaSoft.Storm.TestModels.DatePair>(ref idx),
            nameof(ProcUser.CustomerId) => (AltaSoft.Storm.TestModels.VeryBadNamespace.CustomerId)(long)dr.GetInt64(idx++),
            nameof(ProcUser.CustomerId2) => (AltaSoft.Storm.TestModels.VeryBadNamespace.CustomerId?)(long?)dr.GetInt64OrNull(idx++),
            nameof(ProcUser.CurrencyId) => (AltaSoft.Storm.TestModels.VeryBadNamespace.CurrencyId)(string)dr.GetAnsiStringFixedLength(idx++),
            nameof(ProcUser.TwoValues) => dr.AsJsonOrNull<AltaSoft.Storm.TestModels.TwoValues>(idx++),
            _ => throw new StormException($"'{propertyName}' is not a column of the table")
        };
    }

    /// <inheritdoc />
    public override object CreateDetailRow(StormColumnDef column, StormDbDataReader dr, ref int idx)
    {
        return column.PropertyName switch
        {
            nameof(ProcUser.Dates) => new AltaSoft.Storm.TestModels.DatePair(dr, uint.MaxValue, ref idx),
            nameof(ProcUser.Cars) => new AltaSoft.Storm.TestModels.Car(dr, uint.MaxValue, ref idx),
            nameof(ProcUser.ListOfStrings) => (string)dr.GetAnsiString(idx++),
            nameof(ProcUser.ListOfIntegers) => (int)dr.GetInt32(idx++),
            _ => throw new StormException($"'{column.PropertyName}' is not a details list")
        };
    }

    /// <summary>
    /// Array of StormColumnDef objects representing the column definitions.
    /// </summary>
    internal static readonly StormColumnDef[] __columnDefs =
    {
        new(nameof(ProcUser.UserId), null, "Id", StormColumnFlags.Key | StormColumnFlags.CanSelect | StormColumnFlags.CanInsert, UnifiedDbType.Int32, 0, 0, 0, SaveAs.Default, 0, false, null, null, typeof(AltaSoft.Storm.TestModels.DomainTypes.UserId), null),
        new(nameof(ProcUser.BranchId), null, "BranchId", StormColumnFlags.Key | StormColumnFlags.CanSelect | StormColumnFlags.CanInsert, UnifiedDbType.Int16, 0, 0, 0, SaveAs.Default, 0, false, null, null, typeof(short), null),
        new(nameof(ProcUser.AutoInc), null, "AutoInc", StormColumnFlags.CanSelect | StormColumnFlags.AutoIncrement, UnifiedDbType.Int32, 0, 0, 0, SaveAs.Default, 0, false, null, null, typeof(int), null),
        new(nameof(ProcUser.RowVersion), null, "RowVersion", StormColumnFlags.CanSelect | StormColumnFlags.ConcurrencyCheck | StormColumnFlags.RowVersion, UnifiedDbType.Binary, 8, 0, 0, SaveAs.Default, 0, false, null, null, typeof(AltaSoft.Storm.SqlRowVersion), null),
        new(nameof(ProcUser.Version), null, "Version", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate | StormColumnFlags.ConcurrencyCheck, UnifiedDbType.Int32, 0, 0, 0, SaveAs.Default, 0, false, null, null, typeof(int), null),
        new(nameof(ProcUser.LoginName), null, "LoginName", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate, UnifiedDbType.AnsiString, 20, 0, 0, SaveAs.Default, 0, false, null, null, typeof(string), null),
        new(nameof(ProcUser.FullName), null, "FullName", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate, UnifiedDbType.String, 100, 0, 0, SaveAs.Default, 1, true, null, null, typeof(string), null),
        new(nameof(ProcUser.Roles), null, "Roles", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate, UnifiedDbType.Json, -1, 0, 0, SaveAs.Json, 2, true, null, null, typeof(System.Collections.Generic.List<int>), typeof(System.Collections.Generic.List<int>)),
        new(nameof(ProcUser.DatePair), "Date1", "DP.DT1", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate | StormColumnFlags.ConcurrencyCheck, UnifiedDbType.Date, 0, 0, 0, SaveAs.Default, 0, false, null, null, typeof(AltaSoft.Storm.TestModels.DatePair), null),
        new(nameof(ProcUser.DatePair), "Date2", "DP.DT2", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate, UnifiedDbType.Date, 0, 0, 0, SaveAs.Default, 0, true, null, null, typeof(AltaSoft.Storm.TestModels.DatePair), null),
        new(nameof(ProcUser.CustomerId), null, "CustomerId", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate, UnifiedDbType.Int64, 0, 0, 0, SaveAs.Default, 0, false, null, null, typeof(AltaSoft.Storm.TestModels.VeryBadNamespace.CustomerId), null),
        new(nameof(ProcUser.CustomerId2), null, "CustomerId2", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate, UnifiedDbType.Int64, 0, 0, 0, SaveAs.Default, 0, true, null, null, typeof(AltaSoft.Storm.TestModels.VeryBadNamespace.CustomerId), null),
        new(nameof(ProcUser.CurrencyId), null, "CurrencyId", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate, UnifiedDbType.AnsiStringFixedLength, 3, 0, 0, SaveAs.Default, 0, false, null, null, typeof(AltaSoft.Storm.TestModels.VeryBadNamespace.CurrencyId), null),
        new(nameof(ProcUser.TwoValues), null, "TwoValues", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate, UnifiedDbType.Json, 101, 0, 0, SaveAs.Json, 4, true, null, null, typeof(AltaSoft.Storm.TestModels.TwoValues), typeof(AltaSoft.Storm.TestModels.TwoValues)),
        new(nameof(ProcUser.Dates), null, "Dates", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate, UnifiedDbType.Default, 0, 0, 0, SaveAs.DetailTable, 8, true, typeof(AltaSoft.Storm.TestModels.DatePair), "[UserDates]", typeof(System.Collections.Generic.List<AltaSoft.Storm.TestModels.DatePair>), null),
        new(nameof(ProcUser.Cars), null, "Cars", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate, UnifiedDbType.Default, 0, 0, 0, SaveAs.DetailTable, 16, true, typeof(AltaSoft.Storm.TestModels.Car), "AltaSoft.Storm.TestModels.ProcUserCars", typeof(AltaSoft.Storm.EntityTrackingList<AltaSoft.Storm.TestModels.Car>), null),
        new(nameof(ProcUser.ListOfStrings), null, "StringValue", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate, UnifiedDbType.AnsiString, 100, 0, 0, SaveAs.DetailTable, 32, true, typeof(string), "AltaSoft.Storm.TestModels.ProcUserListOfStrings", typeof(AltaSoft.Storm.TrackingList<string>), null),
        new(nameof(ProcUser.ListOfIntegers), null, "IntegerValue", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate, UnifiedDbType.Int32, 0, 0, 0, SaveAs.DetailTable, 64, true, typeof(int), "AltaSoft.Storm.TestModels.ProcUserListOfIntegers", typeof(AltaSoft.Storm.TrackingList<int>), null)
    };

    /// <summary>
    /// Array of StormColumnDef objects representing the key column definitions.
    /// </summary>
    internal static readonly StormColumnDef[][] __keyColumnDefs = [
        [ __columnDefs[0], __columnDefs[1] ] // PK
    ];

    /// <inheritdoc />
    public override StormColumnDef[] ColumnDefs => __columnDefs;

    /// <inheritdoc />
    public override StormColumnDef[][] KeyColumnDefs => __keyColumnDefs;

    /// <inheritdoc />
    public override bool HasConcurrencyCheck => true;
    /// <inheritdoc />
    public override uint PartialLoadFlagsAll => (uint)ProcUser.PartialLoadFlags.All;
    /// <inheritdoc />
    public override uint PartialLoadFlagsAllWithoutDetails => (uint)ProcUser.PartialLoadFlags.AllExceptDetailTables;

    /// <inheritdoc />
    public override object __ReadKeyValue(StormDbDataReader dr, ref int idx)
    {
        var userId = (AltaSoft.Storm.TestModels.DomainTypes.UserId)(int)dr.GetInt32(idx++);
        var branchId = (short)dr.GetInt16(idx++);
        return (userId, branchId); 
    }
    /// <inheritdoc />
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public override StormColumnDef? __GetAutoIncColumn() => __columnDefs[2];

}

/// <summary>
/// StormContext methods
/// </summary>
internal static partial class TestStormContextProcUserExt
{
    /// <summary>
    /// Select row(s) from <c>Stored Procedure</c>
    /// </summary>
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static IExecuteFrom<ProcUser, ExecuteMyProcOutput> ExecuteMyProc(this TestStormContext context)
    {
        return StormCrudFactory.ExecuteFrom<ProcUser, ExecuteMyProcOutput>(context, 0, [new("ReturnValue", UnifiedDbType.Int32, 0, 0, 0, 0, ParameterDirection.ReturnValue)], OutputWriter);

        static void OutputWriter(int rowsAffected, StormDbParameterCollection parameters, ExecuteMyProcOutput output)
        {
            output.RowsAffected = rowsAffected;
            output.ReturnValue = (int)parameters[0].Value;
        }
    }

    /// <summary>
    /// Output class for <see cref=" ExecuteMyProc"/>
    /// </summary>
    internal record ExecuteMyProcOutput : StormProcedureResult
    {
    }

}
