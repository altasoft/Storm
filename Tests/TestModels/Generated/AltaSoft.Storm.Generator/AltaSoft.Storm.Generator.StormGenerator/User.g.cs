//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by 'AltaSoft Storm ORM Generator'.
//     Changes to this file may cause incorrect behavior and will be lost if the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

#nullable enable

using System;
using System.Collections.Generic;
using System.Data.Common;
using AltaSoft.Storm.Attributes;
using AltaSoft.Storm.Interfaces;
using AltaSoft.Storm.TestModels.VeryBadNamespace;
using System.ComponentModel;
using System.Data;
using System.Linq;
using System.Linq.Expressions;
using System.Runtime.CompilerServices;
using System.Threading;
using System.Threading.Tasks;
using AltaSoft.Storm;
using AltaSoft.Storm.Crud;
using AltaSoft.Storm.Exceptions;
using AltaSoft.Storm.Extensions;

#pragma warning disable IDE1006, CS0612, CS8618
// ReSharper disable InconsistentNaming

namespace AltaSoft.Storm.TestModels;

// UpdateMode: ChangeTracking
// 0. (dbo.UsersTable - Table, ChangeTracking
// 1. (dbo.UsersView - View, NoUpdates
// 2. (dbo.UsersFunc - TableValuedFunction, NoUpdates
// 3. (dbo.UserProc - StoredProcedure, NoUpdates
// 4. (.UsersVirtualView - VirtualView, NoUpdates
// 5. (.UsersCustomSql - CustomSqlStatement, NoUpdates
public partial record User : IDataBindableWithKey, IConcurrencyCheck, ITrackingObject, IEntityComparer<User>
{
    /// <summary>
    /// Default constructor.
    /// </summary>
    public User()
    {
    }

    /// <summary>
    /// Initializes a new instance with the values from the specified DbDataReader and updates the index.
    /// </summary>
    /// <param name="dr">The DbDataReader object containing the data.</param>
    /// <param name="partialLoadFlags">The PartialLoadFlags that used when loading this instance from database.</param>
    /// <param name="idx">The reference to the index.</param>
    #if NET7_0_OR_GREATER
    [System.Diagnostics.CodeAnalysis.SetsRequiredMembers]
    #endif
    protected internal User(StormDbDataReader dr, uint partialLoadFlags, ref int idx)
    {
        __loadingFlags = partialLoadFlags;
        UserId = (AltaSoft.Storm.TestModels.DomainTypes.UserId)(int)dr.GetInt32(idx++);
        BranchId = (short)dr.GetInt16(idx++);
        AutoInc = (int)dr.GetInt32(idx++);
        RowVersion = (AltaSoft.Storm.SqlRowVersion)dr.GetBinary(idx++);
        Lsn = (AltaSoft.Storm.SqlLogSequenceNumber)dr.GetBinary(idx++);
        Version = (int)dr.GetInt32(idx++);
        LoginName = (string)dr.GetAnsiString(idx++);
        FullName = (string?)dr.GetStringOrNull(idx++);
        Roles = dr.AsJsonOrNull<System.Collections.Generic.List<int>>(idx++);
        DatePair = dr.AsFlatObject<AltaSoft.Storm.TestModels.DatePair>(ref idx);
        CustomerId = (AltaSoft.Storm.TestModels.VeryBadNamespace.CustomerId)(long)dr.GetInt64(idx++);
        CustomerId2 = (AltaSoft.Storm.TestModels.VeryBadNamespace.CustomerId?)(long?)dr.GetInt64OrNull(idx++);
        CurrencyId = (AltaSoft.Storm.TestModels.VeryBadNamespace.CurrencyId)(string)dr.GetAnsiStringFixedLength(idx++);
        TwoValues = dr.AsJsonOrNull<AltaSoft.Storm.TestModels.TwoValues>(idx++);
        UserStatus = (AltaSoft.Storm.TestModels.UserStatus)(int)dr.GetInt32(idx++);
        NullableUserStatus = (AltaSoft.Storm.TestModels.UserStatus?)(int?)dr.GetInt32OrNull(idx++);
        TrackableObject = dr.AsJsonOrNull<AltaSoft.Storm.TestModels.TrackableObject>(idx++);
        BigString = dr.AsStringCompressedOrNull(idx++);

        __saved_RowVersion = RowVersion;
        __saved_Version = Version;
        __saved_DatePair_Date1 = DatePair.Date1;
    }

    private AltaSoft.Storm.SqlRowVersion __saved_RowVersion;
    private int __saved_Version;
    private System.DateOnly __saved_DatePair_Date1;

    /// <inheritdoc />
    public bool KeyEquals(User other) => UserId == other.UserId && BranchId == other.BranchId;

    /// <inheritdoc />
    public object __GetKeyValue() => (UserId, BranchId);


    /// <inheritdoc />
    public void __SetAutoIncValue(StormDbDataReader dr, int idx)
    {
        AutoInc = (int)dr.GetInt32(idx++);
    }

    /// <inheritdoc />
    public void __AddDetailRow(StormColumnDef column, object row)
    {
        switch (column.PropertyName)
        {
            case nameof(Dates):
                Dates ??= new(); 
                Dates.Add((AltaSoft.Storm.TestModels.DatePair)row);
                break;
            case nameof(Cars):
                Cars ??= new(); 
                Cars.Add((AltaSoft.Storm.TestModels.Car)row);
                break;
            case nameof(ListOfStrings):
                ListOfStrings ??= new(); 
                ListOfStrings.Add((string)row);
                break;
            case nameof(ListOfIntegers):
                ListOfIntegers ??= new(); 
                ListOfIntegers.Add((int)row);
                break;
        }
    }

    /// <summary>
    /// Represents a set of flags that can be used to specify partial loading options.
    /// </summary>
    [Flags]
    public enum PartialLoadFlags : uint
    {
        Basic = 0,
        FullName = 1,
        Roles = 2,
        TwoValues = 4,
        Dates = 8, // Detail table
        Cars = 16, // Detail table
        ListOfStrings = 32, // Detail table
        ListOfIntegers = 64, // Detail table
        TrackableObject = 128,
        All = Basic | FullName | Roles | TwoValues | Dates | Cars | ListOfStrings | ListOfIntegers | TrackableObject,
        AllExceptDetailTables = Basic | FullName | Roles | TwoValues | TrackableObject
    }

    /// <summary>
    /// Enum representing different options for ordering data.
    /// </summary>
    public enum OrderBy
    {
        UserId = 1,
        UserId_Desc = -1,
        BranchId = 2,
        BranchId_Desc = -2,
        AutoInc = 3,
        AutoInc_Desc = -3,
        RowVersion = 4,
        RowVersion_Desc = -4,
        Lsn = 5,
        Lsn_Desc = -5,
        Version = 6,
        Version_Desc = -6,
        LoginName = 7,
        LoginName_Desc = -7,
        FullName = 8,
        FullName_Desc = -8,
        DatePair_Date1 = 10,
        DatePair_Date1_Desc = -10,
        DatePair_Date2 = 11,
        DatePair_Date2_Desc = -11,
        CustomerId = 12,
        CustomerId_Desc = -12,
        CustomerId2 = 13,
        CustomerId2_Desc = -13,
        CurrencyId = 14,
        CurrencyId_Desc = -14,
        UserStatus = 16,
        UserStatus_Desc = -16,
        NullableUserStatus = 17,
        NullableUserStatus_Desc = -17
    }

    /// <summary>
    /// Do not order queried data.
    /// </summary>
    public const OrderBy[]? Unordered = default;

    /// <summary>
    /// Order queried data by the OrderBy.UserId and OrderBy.BranchId columns
    /// </summary>
    public static readonly OrderBy[] OrderByKey = new[] { OrderBy.UserId, OrderBy.BranchId };

    private uint? __loadingFlags;
    /// <inheritdoc />
    [EditorBrowsable(EditorBrowsableState.Never)]
    public uint? __GetLoadingFlags() => __loadingFlags;

    /// <inheritdoc />
    [EditorBrowsable(EditorBrowsableState.Never)]
    public (StormColumnDef column, object? value)[] __GetColumnValues()
    {
        var columnDefs = UserStormController.__columnDefs;

        return [
            (columnDefs[0], (int)UserId),
            (columnDefs[1], BranchId),
            (columnDefs[2], AutoInc),
            (columnDefs[3], (byte[])RowVersion),
            (columnDefs[4], (byte[])Lsn),
            (columnDefs[5], Version),
            (columnDefs[6], LoginName),
            (columnDefs[7], FullName),
            (columnDefs[8], (object?)Roles),
            (columnDefs[9], (DateOnly)DatePair.Date1),
            (columnDefs[10], (DateOnly?)DatePair.Date2),
            (columnDefs[11], (long)CustomerId),
            (columnDefs[12], (long?)CustomerId2),
            (columnDefs[13], (string)CurrencyId),
            (columnDefs[14], (object?)TwoValues),
            (columnDefs[15], Dates),
            (columnDefs[16], Cars),
            (columnDefs[17], ListOfStrings),
            (columnDefs[18], ListOfIntegers),
            (columnDefs[19], (int)UserStatus),
            (columnDefs[20], (int?)NullableUserStatus),
            (columnDefs[21], (object?)TrackableObject),
            (columnDefs[22], BigString)
        ];
    }


    #region Concurrency Support

    /// <inheritdoc />
    public (StormColumnDef column, object? value)[] __ConcurrencyColumnValues()
    {
        var columnDefs = UserStormController.__columnDefs;

        return [
            (columnDefs[3], (byte[])__saved_RowVersion),
            (columnDefs[5], __saved_Version),
            (columnDefs[9], (DateOnly)__saved_DatePair_Date1),
        ];
    }

    #endregion Concurrency Support

    #region Change Tracking Support

    /// <inheritdoc />
    public virtual (string propertyName, IChangeTrackable? value)[] __TrackableMembers()
    {
return [
            (nameof(DatePair), DatePair),
            (nameof(TwoValues), TwoValues),
            (nameof(Cars), Cars),
            (nameof(ListOfStrings), ListOfStrings),
            (nameof(ListOfIntegers), ListOfIntegers),
            (nameof(TrackableObject), TrackableObject)
        ];
    }
    protected bool _isChangeTrackingActive;
    protected ChangeTrackingStateMachine? _changeTrackingStateMachine;
    /// <inheritdoc />
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool IsChangeTrackingActive() => _isChangeTrackingActive;
    /// <inheritdoc />
    public void StartChangeTracking() { (_changeTrackingStateMachine ??= new(this)).StartChangeTracking(); _isChangeTrackingActive = true; }
    /// <inheritdoc />
    public void AcceptChanges(bool stopTracking = true) { _changeTrackingStateMachine?.AcceptChanges(stopTracking); _isChangeTrackingActive = !stopTracking; }
    /// <inheritdoc />
    public bool IsDirty() => _changeTrackingStateMachine?.IsDirty() ?? false;
    /// <inheritdoc />
    public IReadOnlySet<string> __GetChangedPropertyNames() => _changeTrackingStateMachine is null ? ChangeTrackingStateMachine.EmptyStringSet : _changeTrackingStateMachine.__GetChangedPropertyNames();
    private void __PropertySet_UserId(ref AltaSoft.Storm.TestModels.DomainTypes.UserId newValue, ref AltaSoft.Storm.TestModels.DomainTypes.UserId oldValue) { if (_isChangeTrackingActive && oldValue != newValue) _changeTrackingStateMachine!.PropertyChanged("UserId", newValue); }
    private void __PropertySet_BranchId(ref short newValue, ref short oldValue) { if (_isChangeTrackingActive && oldValue != newValue) _changeTrackingStateMachine!.PropertyChanged("BranchId", newValue); }
    private void __PropertySet_AutoInc(ref int newValue, ref int oldValue) { if (_isChangeTrackingActive && oldValue != newValue) _changeTrackingStateMachine!.PropertyChanged("AutoInc", newValue); }
    private void __PropertySet_RowVersion(ref AltaSoft.Storm.SqlRowVersion newValue, ref AltaSoft.Storm.SqlRowVersion oldValue) { if (_isChangeTrackingActive && oldValue != newValue) _changeTrackingStateMachine!.PropertyChanged("RowVersion", newValue); }
    private void __PropertySet_Lsn(ref AltaSoft.Storm.SqlLogSequenceNumber newValue, ref AltaSoft.Storm.SqlLogSequenceNumber oldValue) { if (_isChangeTrackingActive && oldValue != newValue) _changeTrackingStateMachine!.PropertyChanged("Lsn", newValue); }
    private void __PropertySet_Version(ref int newValue, ref int oldValue) { if (_isChangeTrackingActive && oldValue != newValue) _changeTrackingStateMachine!.PropertyChanged("Version", newValue); }
    private void __PropertySet_LoginName(ref string newValue, ref string oldValue) { if (_isChangeTrackingActive && oldValue != newValue) _changeTrackingStateMachine!.PropertyChanged("LoginName", newValue); }
    private void __PropertySet_FullName(ref string? newValue, ref string? oldValue) { if (_isChangeTrackingActive && oldValue != newValue) _changeTrackingStateMachine!.PropertyChanged("FullName", newValue); }
    private void __PropertySet_Roles(ref System.Collections.Generic.List<int>? newValue, ref System.Collections.Generic.List<int>? oldValue) { if (_isChangeTrackingActive && oldValue != newValue) _changeTrackingStateMachine!.PropertyChanged("Roles", newValue); }
    private void __PropertySet_DatePair(ref AltaSoft.Storm.TestModels.DatePair newValue, ref AltaSoft.Storm.TestModels.DatePair oldValue) { if (_isChangeTrackingActive && oldValue != newValue) _changeTrackingStateMachine!.PropertyChanged("DatePair", newValue); }
    private void __PropertySet_CustomerId(ref AltaSoft.Storm.TestModels.VeryBadNamespace.CustomerId newValue, ref AltaSoft.Storm.TestModels.VeryBadNamespace.CustomerId oldValue) { if (_isChangeTrackingActive && oldValue != newValue) _changeTrackingStateMachine!.PropertyChanged("CustomerId", newValue); }
    private void __PropertySet_CustomerId2(ref AltaSoft.Storm.TestModels.VeryBadNamespace.CustomerId? newValue, ref AltaSoft.Storm.TestModels.VeryBadNamespace.CustomerId? oldValue) { if (_isChangeTrackingActive && oldValue != newValue) _changeTrackingStateMachine!.PropertyChanged("CustomerId2", newValue); }
    private void __PropertySet_CurrencyId(ref AltaSoft.Storm.TestModels.VeryBadNamespace.CurrencyId newValue, ref AltaSoft.Storm.TestModels.VeryBadNamespace.CurrencyId oldValue) { if (_isChangeTrackingActive && oldValue != newValue) _changeTrackingStateMachine!.PropertyChanged("CurrencyId", newValue); }
    private void __PropertySet_TwoValues(ref AltaSoft.Storm.TestModels.TwoValues? newValue, ref AltaSoft.Storm.TestModels.TwoValues? oldValue) { if (_isChangeTrackingActive && oldValue != newValue) _changeTrackingStateMachine!.PropertyChanged("TwoValues", newValue); }
    private void __PropertySet_Dates(ref System.Collections.Generic.List<AltaSoft.Storm.TestModels.DatePair>? newValue, ref System.Collections.Generic.List<AltaSoft.Storm.TestModels.DatePair>? oldValue) { if (_isChangeTrackingActive && oldValue != newValue) _changeTrackingStateMachine!.PropertyChanged("Dates", newValue); }
    private void __PropertySet_Cars(ref AltaSoft.Storm.EntityTrackingList<AltaSoft.Storm.TestModels.Car>? newValue, ref AltaSoft.Storm.EntityTrackingList<AltaSoft.Storm.TestModels.Car>? oldValue) { if (_isChangeTrackingActive && oldValue != newValue) _changeTrackingStateMachine!.PropertyChanged("Cars", newValue); }
    private void __PropertySet_ListOfStrings(ref AltaSoft.Storm.TrackingList<string>? newValue, ref AltaSoft.Storm.TrackingList<string>? oldValue) { if (_isChangeTrackingActive && oldValue != newValue) _changeTrackingStateMachine!.PropertyChanged("ListOfStrings", newValue); }
    private void __PropertySet_ListOfIntegers(ref AltaSoft.Storm.TrackingList<int>? newValue, ref AltaSoft.Storm.TrackingList<int>? oldValue) { if (_isChangeTrackingActive && oldValue != newValue) _changeTrackingStateMachine!.PropertyChanged("ListOfIntegers", newValue); }
    private void __PropertySet_UserStatus(ref AltaSoft.Storm.TestModels.UserStatus newValue, ref AltaSoft.Storm.TestModels.UserStatus oldValue) { if (_isChangeTrackingActive && oldValue != newValue) _changeTrackingStateMachine!.PropertyChanged("UserStatus", newValue); }
    private void __PropertySet_NullableUserStatus(ref AltaSoft.Storm.TestModels.UserStatus? newValue, ref AltaSoft.Storm.TestModels.UserStatus? oldValue) { if (_isChangeTrackingActive && oldValue != newValue) _changeTrackingStateMachine!.PropertyChanged("NullableUserStatus", newValue); }
    private void __PropertySet_TrackableObject(ref AltaSoft.Storm.TestModels.TrackableObject? newValue, ref AltaSoft.Storm.TestModels.TrackableObject? oldValue) { if (_isChangeTrackingActive && oldValue != newValue) _changeTrackingStateMachine!.PropertyChanged("TrackableObject", newValue); }
    private void __PropertySet_BigString(ref string? newValue, ref string? oldValue) { if (_isChangeTrackingActive && oldValue != newValue) _changeTrackingStateMachine!.PropertyChanged("BigString", newValue); }

    #endregion Change Tracking Support
}

/// <summary>
/// 0. StormController for the User (dbo.UsersTable)
/// 1. StormController for the User (dbo.UsersView)
/// 2. StormController for the User (dbo.UsersFunc)
/// 3. StormController for the User (dbo.UserProc)
/// 4. StormController for the User (.UsersVirtualView)
/// 5. StormController for the User (.UsersCustomSql)
/// </summary>
[StormController("dbo", "Users", typeof(User), 0, DbObjectType.Table)]
[StormController("dbo", "UsersView", typeof(User), 1, DbObjectType.View)]
[StormController("dbo", "users_func", typeof(User), 2, DbObjectType.TableValuedFunction)]
[StormController("dbo", "users_proc", typeof(User), 3, DbObjectType.StoredProcedure)]
[StormController(default, VirtualViewSql4, typeof(User), 4, DbObjectType.VirtualView)]
[StormController(default, "", typeof(User), 5, DbObjectType.CustomSqlStatement)]
public sealed class UserStormController : StormControllerBase
{
    public UserStormController(string? schemaName, string objectName, DbObjectType objectType) : base(schemaName, objectName, objectType)
    {
    }

    /// <inheritdoc />
    public override Type StormContext => typeof(TestStormContext);

    internal const string VirtualViewSql4 =
        """
        SELECT * FROM {%schema%}.Users
        WHERE Id > 5
        """;

    [System.Runtime.CompilerServices.ModuleInitializer]
    internal static void Initialize()
    {
        StormControllerBase ctrl;
        ctrl = new UserStormController("dbo", "Users", DbObjectType.Table);
        StormControllerCache.Add(typeof(User), 0, ctrl);
        ctrl = new UserStormController("dbo", "UsersView", DbObjectType.View);
        StormControllerCache.Add(typeof(User), 1, ctrl);
        ctrl = new UserStormController("dbo", "users_func", DbObjectType.TableValuedFunction);
        StormControllerCache.Add(typeof(User), 2, ctrl);
        ctrl = new UserStormController("dbo", "users_proc", DbObjectType.StoredProcedure);
        StormControllerCache.Add(typeof(User), 3, ctrl);
        ctrl = new UserStormController(null, VirtualViewSql4, DbObjectType.VirtualView);
        StormControllerCache.Add(typeof(User), 4, ctrl);
        StormControllerCache.Add(typeof(User), 5, () => new UserStormController(null, string.Empty, DbObjectType.CustomSqlStatement));
    }

    /// <inheritdoc />
    public override IDataBindable Create(StormDbDataReader dr, uint partialLoadFlags, ref int idx)
    {
        var result = new User(dr, partialLoadFlags, ref idx);
        result.AfterLoad(partialLoadFlags);
        return result;
    }

    /// <inheritdoc />
    public override object? ReadSingleScalarValue(StormDbDataReader dr, string propertyName, ref int idx)
    {
        return propertyName switch
        {
            nameof(User.UserId) => (AltaSoft.Storm.TestModels.DomainTypes.UserId)(int)dr.GetInt32(idx++),
            nameof(User.BranchId) => (short)dr.GetInt16(idx++),
            nameof(User.AutoInc) => (int)dr.GetInt32(idx++),
            nameof(User.RowVersion) => (AltaSoft.Storm.SqlRowVersion)dr.GetBinary(idx++),
            nameof(User.Lsn) => (AltaSoft.Storm.SqlLogSequenceNumber)dr.GetBinary(idx++),
            nameof(User.Version) => (int)dr.GetInt32(idx++),
            nameof(User.LoginName) => (string)dr.GetAnsiString(idx++),
            nameof(User.FullName) => (string?)dr.GetStringOrNull(idx++),
            nameof(User.Roles) => dr.AsJsonOrNull<System.Collections.Generic.List<int>>(idx++),
            nameof(User.DatePair) => dr.AsFlatObject<AltaSoft.Storm.TestModels.DatePair>(ref idx),
            nameof(User.CustomerId) => (AltaSoft.Storm.TestModels.VeryBadNamespace.CustomerId)(long)dr.GetInt64(idx++),
            nameof(User.CustomerId2) => (AltaSoft.Storm.TestModels.VeryBadNamespace.CustomerId?)(long?)dr.GetInt64OrNull(idx++),
            nameof(User.CurrencyId) => (AltaSoft.Storm.TestModels.VeryBadNamespace.CurrencyId)(string)dr.GetAnsiStringFixedLength(idx++),
            nameof(User.TwoValues) => dr.AsJsonOrNull<AltaSoft.Storm.TestModels.TwoValues>(idx++),
            nameof(User.UserStatus) => (AltaSoft.Storm.TestModels.UserStatus)(int)dr.GetInt32(idx++),
            nameof(User.NullableUserStatus) => (AltaSoft.Storm.TestModels.UserStatus?)(int?)dr.GetInt32OrNull(idx++),
            nameof(User.TrackableObject) => dr.AsJsonOrNull<AltaSoft.Storm.TestModels.TrackableObject>(idx++),
            nameof(User.BigString) => dr.AsStringCompressedOrNull(idx++),
            _ => throw new StormException($"'{propertyName}' is not a column of the table")
        };
    }

    /// <inheritdoc />
    public override object CreateDetailRow(StormColumnDef column, StormDbDataReader dr, ref int idx)
    {
        return column.PropertyName switch
        {
            nameof(User.Dates) => new AltaSoft.Storm.TestModels.DatePair(dr, uint.MaxValue, ref idx),
            nameof(User.Cars) => new AltaSoft.Storm.TestModels.Car(dr, uint.MaxValue, ref idx),
            nameof(User.ListOfStrings) => (string)dr.GetAnsiString(idx++),
            nameof(User.ListOfIntegers) => (int)dr.GetInt32(idx++),
            _ => throw new StormException($"'{column.PropertyName}' is not a details list")
        };
    }

    /// <summary>
    /// Array of StormColumnDef objects representing the column definitions.
    /// </summary>
    internal static readonly StormColumnDef[] __columnDefs =
    {
        new(nameof(User.UserId), null, "Id", StormColumnFlags.Key | StormColumnFlags.CanSelect | StormColumnFlags.CanInsert, UnifiedDbType.Int32, 0, 0, 0, SaveAs.Default, 0, false, null, null, typeof(AltaSoft.Storm.TestModels.DomainTypes.UserId), null),
        new(nameof(User.BranchId), null, "BranchId", StormColumnFlags.Key | StormColumnFlags.CanSelect | StormColumnFlags.CanInsert, UnifiedDbType.Int16, 0, 0, 0, SaveAs.Default, 0, false, null, null, typeof(short), null),
        new(nameof(User.AutoInc), null, "AutoInc", StormColumnFlags.CanSelect | StormColumnFlags.AutoIncrement, UnifiedDbType.Int32, 0, 0, 0, SaveAs.Default, 0, false, null, null, typeof(int), null),
        new(nameof(User.RowVersion), null, "RowVersion", StormColumnFlags.CanSelect | StormColumnFlags.ConcurrencyCheck | StormColumnFlags.RowVersion, UnifiedDbType.Binary, 8, 0, 0, SaveAs.Default, 0, false, null, null, typeof(AltaSoft.Storm.SqlRowVersion), null),
        new(nameof(User.Lsn), null, "Lsn", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate, UnifiedDbType.Binary, 10, 0, 0, SaveAs.Default, 0, false, null, null, typeof(AltaSoft.Storm.SqlLogSequenceNumber), null),
        new(nameof(User.Version), null, "Version", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate | StormColumnFlags.ConcurrencyCheck, UnifiedDbType.Int32, 0, 0, 0, SaveAs.Default, 0, false, null, null, typeof(int), null),
        new(nameof(User.LoginName), null, "LoginName", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate, UnifiedDbType.AnsiString, 20, 0, 0, SaveAs.Default, 0, false, null, null, typeof(string), null),
        new(nameof(User.FullName), null, "FullName", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate, UnifiedDbType.String, 100, 0, 0, SaveAs.Default, 1, true, null, null, typeof(string), null),
        new(nameof(User.Roles), null, "Roles", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate, UnifiedDbType.Json, -1, 0, 0, SaveAs.Json, 2, true, null, null, typeof(System.Collections.Generic.List<int>), typeof(System.Collections.Generic.List<int>)),
        new(nameof(User.DatePair), "Date1", "DP.DT1", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate | StormColumnFlags.ConcurrencyCheck, UnifiedDbType.Date, 0, 0, 0, SaveAs.Default, 0, false, null, null, typeof(AltaSoft.Storm.TestModels.DatePair), null),
        new(nameof(User.DatePair), "Date2", "DP.DT2", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate, UnifiedDbType.Date, 0, 0, 0, SaveAs.Default, 0, true, null, null, typeof(AltaSoft.Storm.TestModels.DatePair), null),
        new(nameof(User.CustomerId), null, "CustomerId", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate, UnifiedDbType.Int64, 0, 0, 0, SaveAs.Default, 0, false, null, null, typeof(AltaSoft.Storm.TestModels.VeryBadNamespace.CustomerId), null),
        new(nameof(User.CustomerId2), null, "CustomerId2", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate, UnifiedDbType.Int64, 0, 0, 0, SaveAs.Default, 0, true, null, null, typeof(AltaSoft.Storm.TestModels.VeryBadNamespace.CustomerId), null),
        new(nameof(User.CurrencyId), null, "CurrencyId", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate, UnifiedDbType.AnsiStringFixedLength, 3, 0, 0, SaveAs.Default, 0, false, null, null, typeof(AltaSoft.Storm.TestModels.VeryBadNamespace.CurrencyId), null),
        new(nameof(User.TwoValues), null, "TwoValues", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate, UnifiedDbType.Json, 101, 0, 0, SaveAs.Json, 4, true, null, null, typeof(AltaSoft.Storm.TestModels.TwoValues), typeof(AltaSoft.Storm.TestModels.TwoValues)),
        new(nameof(User.Dates), null, "Dates", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate, UnifiedDbType.Default, 0, 0, 0, SaveAs.DetailTable, 8, true, typeof(AltaSoft.Storm.TestModels.DatePair), "[UserDates]", typeof(System.Collections.Generic.List<AltaSoft.Storm.TestModels.DatePair>), null),
        new(nameof(User.Cars), null, "Cars", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate, UnifiedDbType.Default, 0, 0, 0, SaveAs.DetailTable, 16, true, typeof(AltaSoft.Storm.TestModels.Car), "AltaSoft.Storm.TestModels.UserCars", typeof(AltaSoft.Storm.EntityTrackingList<AltaSoft.Storm.TestModels.Car>), null),
        new(nameof(User.ListOfStrings), null, "StringValue", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate, UnifiedDbType.AnsiString, 100, 0, 0, SaveAs.DetailTable, 32, true, typeof(string), "AltaSoft.Storm.TestModels.UserListOfStrings", typeof(AltaSoft.Storm.TrackingList<string>), null),
        new(nameof(User.ListOfIntegers), null, "IntegerValue", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate, UnifiedDbType.Int32, 0, 0, 0, SaveAs.DetailTable, 64, true, typeof(int), "AltaSoft.Storm.TestModels.UserListOfIntegers", typeof(AltaSoft.Storm.TrackingList<int>), null),
        new(nameof(User.UserStatus), null, "UserStatus", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate, UnifiedDbType.Int32, 0, 0, 0, SaveAs.Default, 0, false, null, null, typeof(AltaSoft.Storm.TestModels.UserStatus), null),
        new(nameof(User.NullableUserStatus), null, "NullableUserStatus", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate, UnifiedDbType.Int32, 0, 0, 0, SaveAs.Default, 0, true, null, null, typeof(AltaSoft.Storm.TestModels.UserStatus), null),
        new(nameof(User.TrackableObject), null, "TrackableObject", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate, UnifiedDbType.Json, -1, 0, 0, SaveAs.Json, 128, true, null, null, typeof(AltaSoft.Storm.TestModels.TrackableObject), typeof(AltaSoft.Storm.TestModels.TrackableObject)),
        new(nameof(User.BigString), null, "BigString", StormColumnFlags.CanSelect | StormColumnFlags.CanInsert | StormColumnFlags.CanUpdate, UnifiedDbType.VarBinary, 1000, 0, 0, SaveAs.CompressedString, 0, true, null, null, typeof(string), null)
    };

    /// <summary>
    /// Array of StormColumnDef objects representing the key column definitions.
    /// </summary>
    internal static readonly StormColumnDef[][] __keyColumnDefs = [
        [ __columnDefs[0], __columnDefs[1] ], // PK
        [ __columnDefs[2] ] // IX_USER_AUTOINC
    ];

    /// <inheritdoc />
    public override StormColumnDef[] ColumnDefs => __columnDefs;

    /// <inheritdoc />
    public override StormColumnDef[][] KeyColumnDefs => __keyColumnDefs;

    /// <inheritdoc />
    public override bool HasConcurrencyCheck => true;
    /// <inheritdoc />
    public override uint PartialLoadFlagsAll => (uint)User.PartialLoadFlags.All;
    /// <inheritdoc />
    public override uint PartialLoadFlagsAllWithoutDetails => (uint)User.PartialLoadFlags.AllExceptDetailTables;

    /// <inheritdoc />
    public override object __ReadKeyValue(StormDbDataReader dr, ref int idx)
    {
        var userId = (AltaSoft.Storm.TestModels.DomainTypes.UserId)(int)dr.GetInt32(idx++);
        var branchId = (short)dr.GetInt16(idx++);
        return (userId, branchId); 
    }
    /// <inheritdoc />
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public override StormColumnDef? __GetAutoIncColumn() => __columnDefs[2];

}

/// <summary>
/// StormContext methods
/// </summary>
public static partial class TestStormContextUserExt
{
    /// <summary>
    /// Select row(s)
    /// </summary>
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static ISelectFrom<User, User.OrderBy, User.PartialLoadFlags> SelectFromUsersTable(this TestStormContext context) => StormCrudFactory.SelectFrom<User, User.OrderBy, User.PartialLoadFlags>(context, 0);
    /// <summary>
    /// Select single row by PK
    /// </summary>
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static ISelectFromSingle<User, User.OrderBy, User.PartialLoadFlags> SelectFromUsersTable(this TestStormContext context, AltaSoft.Storm.TestModels.DomainTypes.UserId userId, short branchId) => StormCrudFactory.SelectFromSingle<User, User.OrderBy, User.PartialLoadFlags>(context, 0, [userId, branchId], 0);
    /// <summary>
    /// Select rows using non-unique index
    /// </summary>
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static ISelectFrom<User, User.OrderBy, User.PartialLoadFlags> SelectFromUsersTable(this TestStormContext context, AltaSoft.Storm.TestModels.DomainTypes.UserId userId) => StormCrudFactory.SelectFrom<User, User.OrderBy, User.PartialLoadFlags>(context, 0, [userId], 1);
    /// <summary>
    /// Select rows using non-unique index
    /// </summary>
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static ISelectFrom<User, User.OrderBy, User.PartialLoadFlags> SelectFromUsersTable(this TestStormContext context, short branchId) => StormCrudFactory.SelectFrom<User, User.OrderBy, User.PartialLoadFlags>(context, 0, [branchId], 2);
    /// <summary>
    /// Select single row using unique index
    /// </summary>
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static ISelectFromSingle<User, User.OrderBy, User.PartialLoadFlags> SelectFromUsersTable(this TestStormContext context, int autoInc) => StormCrudFactory.SelectFromSingle<User, User.OrderBy, User.PartialLoadFlags>(context, 0, [autoInc], 3);
    /// <summary>
    /// Delete row(s)
    /// </summary>
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static IDeleteFrom<User> DeleteFromUsersTable(this TestStormContext context) => StormCrudFactory.DeleteFrom<User>(context, 0);
    /// <summary>
    /// Delete row using PK
    /// </summary>
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static IDeleteFromSingle<User> DeleteFromUsersTable(this TestStormContext context, AltaSoft.Storm.TestModels.DomainTypes.UserId userId, short branchId) => StormCrudFactory.DeleteFromSingle<User>(context, 0, [userId, branchId], 0);
    /// <summary>
    /// Delete row using 1 value
    /// </summary>
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static IDeleteFromSingle<User> DeleteFromUsersTable(this TestStormContext context, User value) => StormCrudFactory.DeleteFromSingle<User>(context, 0, value);
    /// <summary>
    /// Delete rows using values
    /// </summary>
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static IDeleteFromSingle<User> DeleteFromUsersTable(this TestStormContext context, IEnumerable<User> values) => StormCrudFactory.DeleteFromSingle<User>(context, 0, values);
    /// <summary>
    /// Insert row(s)
    /// </summary>
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static IInsertInto<User> InsertIntoUsersTable(this TestStormContext context) => StormCrudFactory.InsertInto<User>(context, 0);
    /// <summary>
    /// Update row(s)
    /// </summary>
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static IUpdateFrom<User> UpdateUsersTable(this TestStormContext context) => StormCrudFactory.UpdateFrom<User>(context, 0);
    /// <summary>
    /// Update row using PK
    /// </summary>
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static IUpdateFromSingle<User> UpdateUsersTable(this TestStormContext context, AltaSoft.Storm.TestModels.DomainTypes.UserId userId, short branchId) => StormCrudFactory.UpdateFromSingle<User>(context, 0, [userId, branchId], 0);
    /// <summary>
    /// Merge row(s)
    /// </summary>
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static IMergeInto<User> MergeIntoUsersTable(this TestStormContext context) => StormCrudFactory.MergeInto<User>(context, 0);
}
/// <summary>
/// StormContext methods
/// </summary>
public static partial class TestStormContextUserExt
{
    /// <summary>
    /// Select row(s)
    /// </summary>
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static ISelectFrom<User, User.OrderBy, User.PartialLoadFlags> SelectFromUsersView(this TestStormContext context) => StormCrudFactory.SelectFrom<User, User.OrderBy, User.PartialLoadFlags>(context, 1);
    /// <summary>
    /// Select single row by PK
    /// </summary>
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static ISelectFromSingle<User, User.OrderBy, User.PartialLoadFlags> SelectFromUsersView(this TestStormContext context, AltaSoft.Storm.TestModels.DomainTypes.UserId userId, short branchId) => StormCrudFactory.SelectFromSingle<User, User.OrderBy, User.PartialLoadFlags>(context, 1, [userId, branchId], 0);
    /// <summary>
    /// Select rows using non-unique index
    /// </summary>
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static ISelectFrom<User, User.OrderBy, User.PartialLoadFlags> SelectFromUsersView(this TestStormContext context, AltaSoft.Storm.TestModels.DomainTypes.UserId userId) => StormCrudFactory.SelectFrom<User, User.OrderBy, User.PartialLoadFlags>(context, 1, [userId], 1);
    /// <summary>
    /// Select rows using non-unique index
    /// </summary>
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static ISelectFrom<User, User.OrderBy, User.PartialLoadFlags> SelectFromUsersView(this TestStormContext context, short branchId) => StormCrudFactory.SelectFrom<User, User.OrderBy, User.PartialLoadFlags>(context, 1, [branchId], 2);
    /// <summary>
    /// Select single row using unique index
    /// </summary>
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static ISelectFromSingle<User, User.OrderBy, User.PartialLoadFlags> SelectFromUsersView(this TestStormContext context, int autoInc) => StormCrudFactory.SelectFromSingle<User, User.OrderBy, User.PartialLoadFlags>(context, 1, [autoInc], 3);
}
/// <summary>
/// StormContext methods
/// </summary>
public static partial class TestStormContextUserExt
{
    /// <summary>
    /// Select row(s) from <c>Table Valued Function</c>
    /// </summary>
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static ISelectFrom<User, User.OrderBy, User.PartialLoadFlags> SelectFromUsersFunc(this TestStormContext context, AltaSoft.Storm.TestModels.DomainTypes.UserId userId)
    {
        var callParams = new List<StormCallParameter>(1)
        {
            new("@userId", UnifiedDbType.Int32, userId, 0, 0, 0, ParameterDirection.Input)
        };

        return StormCrudFactory.SelectFrom<User, User.OrderBy, User.PartialLoadFlags>(context, 2, callParams);
    }
}
/// <summary>
/// StormContext methods
/// </summary>
public static partial class TestStormContextUserExt
{
    /// <summary>
    /// Select row(s) from <c>Stored Procedure</c>
    /// </summary>
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static IExecuteFrom<User, ExecuteUserProcOutput> ExecuteUserProc(this TestStormContext context, AltaSoft.Storm.TestModels.DomainTypes.UserId userId, AltaSoft.Storm.TestModels.VeryBadNamespace.CustomerId? io)
    {
        var callParams = new List<StormCallParameter>(2)
        {
new("ReturnValue", UnifiedDbType.Int32, 0, 0, 0, 0, ParameterDirection.ReturnValue),
            new("@userId", UnifiedDbType.Int32, userId, 0, 0, 0, ParameterDirection.Input),
            new("@io", UnifiedDbType.Int64, io, 0, 0, 0, ParameterDirection.InputOutput)
        };

        return StormCrudFactory.ExecuteFrom<User, ExecuteUserProcOutput>(context, 3, callParams, OutputWriter);

        static void OutputWriter(int rowsAffected, StormDbParameterCollection parameters, ExecuteUserProcOutput output)
        {
            output.RowsAffected = rowsAffected;
            output.ReturnValue = (int)parameters[0].Value;
            output.Io = parameters["@io"].Value.GetDbValue<long?>();
        }
    }

    /// <summary>
    /// Output class for <see cref=" ExecuteUserProc"/>
    /// </summary>
    public record ExecuteUserProcOutput : StormProcedureResult
    {
        public AltaSoft.Storm.TestModels.VeryBadNamespace.CustomerId? Io { get; set; }
    }

}
/// <summary>
/// StormContext methods
/// </summary>
public static partial class TestStormContextUserExt
{
    /// <summary>
    /// Select row(s)
    /// </summary>
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static ISelectFrom<User, User.OrderBy, User.PartialLoadFlags> SelectFromUsersVirtualView(this TestStormContext context) => StormCrudFactory.SelectFrom<User, User.OrderBy, User.PartialLoadFlags>(context, 4);
    /// <summary>
    /// Select single row by PK
    /// </summary>
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static ISelectFromSingle<User, User.OrderBy, User.PartialLoadFlags> SelectFromUsersVirtualView(this TestStormContext context, AltaSoft.Storm.TestModels.DomainTypes.UserId userId, short branchId) => StormCrudFactory.SelectFromSingle<User, User.OrderBy, User.PartialLoadFlags>(context, 4, [userId, branchId], 0);
    /// <summary>
    /// Select rows using non-unique index
    /// </summary>
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static ISelectFrom<User, User.OrderBy, User.PartialLoadFlags> SelectFromUsersVirtualView(this TestStormContext context, AltaSoft.Storm.TestModels.DomainTypes.UserId userId) => StormCrudFactory.SelectFrom<User, User.OrderBy, User.PartialLoadFlags>(context, 4, [userId], 1);
    /// <summary>
    /// Select rows using non-unique index
    /// </summary>
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static ISelectFrom<User, User.OrderBy, User.PartialLoadFlags> SelectFromUsersVirtualView(this TestStormContext context, short branchId) => StormCrudFactory.SelectFrom<User, User.OrderBy, User.PartialLoadFlags>(context, 4, [branchId], 2);
    /// <summary>
    /// Select single row using unique index
    /// </summary>
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static ISelectFromSingle<User, User.OrderBy, User.PartialLoadFlags> SelectFromUsersVirtualView(this TestStormContext context, int autoInc) => StormCrudFactory.SelectFromSingle<User, User.OrderBy, User.PartialLoadFlags>(context, 4, [autoInc], 3);
}
/// <summary>
/// StormContext methods
/// </summary>
public static partial class TestStormContextUserExt
{
    /// <summary>
    /// Select row(s)
    /// </summary>
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static ISelectFrom<User, User.OrderBy, User.PartialLoadFlags> SelectFromUsersCustomSql(this TestStormContext context, string customSqlStatement, List<StormCallParameter>? callParameters = null) => StormCrudFactory.SelectFrom<User, User.OrderBy, User.PartialLoadFlags>(context, 5, customSqlStatement, callParameters);
    /// <summary>
    /// Select single row by PK
    /// </summary>
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static ISelectFromSingle<User, User.OrderBy, User.PartialLoadFlags> SelectFromUsersCustomSql(this TestStormContext context, AltaSoft.Storm.TestModels.DomainTypes.UserId userId, short branchId, string customSqlStatement, List<StormCallParameter>? callParameters = null) => StormCrudFactory.SelectFromSingle<User, User.OrderBy, User.PartialLoadFlags>(context, 5, [userId, branchId], 0, customSqlStatement, callParameters);
    /// <summary>
    /// Select rows using non-unique index
    /// </summary>
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static ISelectFrom<User, User.OrderBy, User.PartialLoadFlags> SelectFromUsersCustomSql(this TestStormContext context, AltaSoft.Storm.TestModels.DomainTypes.UserId userId, string customSqlStatement, List<StormCallParameter>? callParameters = null) => StormCrudFactory.SelectFrom<User, User.OrderBy, User.PartialLoadFlags>(context, 5, [userId], 1, customSqlStatement, callParameters);
    /// <summary>
    /// Select rows using non-unique index
    /// </summary>
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static ISelectFrom<User, User.OrderBy, User.PartialLoadFlags> SelectFromUsersCustomSql(this TestStormContext context, short branchId, string customSqlStatement, List<StormCallParameter>? callParameters = null) => StormCrudFactory.SelectFrom<User, User.OrderBy, User.PartialLoadFlags>(context, 5, [branchId], 2, customSqlStatement, callParameters);
    /// <summary>
    /// Select single row using unique index
    /// </summary>
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static ISelectFromSingle<User, User.OrderBy, User.PartialLoadFlags> SelectFromUsersCustomSql(this TestStormContext context, int autoInc, string customSqlStatement, List<StormCallParameter>? callParameters = null) => StormCrudFactory.SelectFromSingle<User, User.OrderBy, User.PartialLoadFlags>(context, 5, [autoInc], 3, customSqlStatement, callParameters);
}
